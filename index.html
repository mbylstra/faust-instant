<html>
  <body>
    <script src="libfaust.js"></script>
    <script src="webaudio-asm-wrapper.js"></script>

    <script>
      let tmp = "asdf";
      var audioContext = new AudioContext();
      var BUFFER_SIZE = 1024;
      // console.log("faust", faust);
      // fetch('faustcode/bogus.lib')
      // fetch('faustcode/math.lib')
      // fetch('faustcode/most-basic.dsp')
      // fetch('faustcode/echo.dsp')
      fetch('faustcode/noise.dsp').then((response) => {
        return response.text();
      }).then((code) => {
        console.log(code);
        //var args = ["-I", "http://" + window.location.hostname + "/faust-stdlib/"];
        var args = ["-I", "http://localhost:8080/faust-stdlib/"];
        // var args = ["-I", "/faust-stdlib/"];
        console.log("args", args);
        var factory = faust.createDSPFactory(code, args);
        console.log("faust.error_msg: ", faust.error_msg);
        console.log("factory", factory);
        var dsp = faust.createDSPInstance(factory, audioContext, BUFFER_SIZE);

        dsp.connect(audioContext.destination);       // connect the source to the context's destination (the speakers)

        console.log(dsp);
      })
    </script>
  </body>
</html>
